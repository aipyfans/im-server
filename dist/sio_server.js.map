{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"fs\"","webpack:///external \"http\"","webpack:///external \"babel-polyfill\"","webpack:///./src/database/db-specs.js","webpack:///./src/middlewares/rest.js","webpack:///./src/database/models/User.js","webpack:///./src/database/models sync \\.js$","webpack:///./src/database/config/config-override.js","webpack:///./src/database/config/config-default.js","webpack:///./src/database/config/config.js","webpack:///external \"node-uuid\"","webpack:///external \"sequelize\"","webpack:///./src/database/db-models.js","webpack:///./src/error/index.js","webpack:///./src/apis/user.js","webpack:///./src/apis sync \\.js$","webpack:///external \"koa-router\"","webpack:///./src/middlewares/apis.js","webpack:///external \"socket.io\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa\"","webpack:///./src/app.js","webpack:///./src/start.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","prototype","hasOwnProperty","p","s","e","t","require","Symbol","iterator","constructor","u","a","generateId","uuid","v4","console","log","sequelize","Sequelize","config","database","username","password","host","dialect","pool","max","min","idle","ID_TYPE","STRING","exp","defineModel","attributes","attrs","key","_typeof","type","allowNull","id","primaryKey","createdAt","BIGINT","updatedAt","version","define","tableName","timestamps","hooks","beforeValidate","obj","now","Date","isNewRecord","sync","Error","v","_step","_iterator","_iteratorNormalCompletion","next","done","ID","pathPrefix","regeneratorRuntime","mark","_callee","ctx","wrap","_context","prev","request","path","startsWith","method","url","rest","data","response","body","JSON","stringify","t0","catch","status","code","message","stop","_ref","_x","_x2","apply","this","arguments","db","email","unique","passwd","gender","BOOLEAN","map","./User.js","webpackContext","req","webpackContextResolve","keys","resolve","port","defaultConfig","overrideConfig","fs","statSync","isFile","assign","err","exportModels","context","forEach","model","substring","length","ApiError","User","GET /api/users","users","findAll","sent","undefined","./user.js","mapping","router","Router","api","post","put","del","addControllers","routes","_http","Promise","then","_ref2","koaApp","Koa","use","_asyncToGenerator","_callee2","start","ms","_context2","getTime","_x3","_x4","_koaBodyparser2","_rest2","_apis2","webServer","createServer","callback","SioServer","on","socket","emit","hello","listen"],"mappings":"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","file":"sio_server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 89);\n","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"babel-polyfill\");","import Sequelize from 'sequelize';\nimport uuid from 'node-uuid';\nimport config from './config/config';\n\nconsole.log('init sequelize...');\n\nfunction generateId() {\n    return uuid.v4();\n}\n\nlet sequelize = new Sequelize(\n    config.database,\n    config.username,\n    config.password,\n    {\n        host: config.host,\n        dialect: config.dialect,\n        pool: {\n            max: 5,\n            min: 0,\n            idle: 10000\n        }\n    }\n);\n\nconst ID_TYPE = Sequelize.STRING(50);\n\nfunction defineModel(name, attributes) {\n    let attrs = {};\n    for (let key in attributes) {\n        let value = attributes[key];\n        if (typeof value === 'object' && value['type']) {\n            value.allowNull = value.allowNull || false;\n            attrs[key] = value;\n        } else {\n            attrs[key] = {\n                type: value,\n                allowNull: false\n            };\n        }\n    }\n    attrs.id = {\n        type: ID_TYPE,\n        primaryKey: true\n    };\n    attrs.createdAt = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    attrs.updatedAt = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    attrs.version = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    // console.log('model defined for table: ' + name + '\\n' + JSON.stringify(attrs, function (k, v) {\n    //     if (k === 'type') {\n    //         for (let key in Sequelize) {\n    //             if (key === 'ABSTRACT' || key === 'NUMBER') {\n    //                 continue;\n    //             }\n    //             let dbType = Sequelize[key];\n    //             if (typeof dbType === 'function') {\n    //                 if (v instanceof dbType) {\n    //                     if (v._length) {\n    //                         return `${dbType.key}(${v._length})`;\n    //                     }\n    //                     return dbType.key;\n    //                 }\n    //                 if (v === dbType) {\n    //                     return dbType.key;\n    //                 }\n    //             }\n    //         }\n    //     }\n    //     return v;\n    // }, '  '));\n    return sequelize.define(name, attrs, {\n        tableName: name,\n        timestamps: false,\n        hooks: {\n            beforeValidate: function (obj) {\n                let now = Date.now();\n                if (obj.isNewRecord) {\n                    console.log('will create entity...' + obj);\n                    if (!obj.id) {\n                        obj.id = generateId();\n                    }\n                    obj.createdAt = now;\n                    obj.updatedAt = now;\n                    obj.version = 0;\n                } else {\n                    console.log('will update entity...');\n                    obj.updatedAt = now;\n                    obj.version++;\n                }\n            }\n        }\n    });\n}\n\nconst TYPES = ['STRING', 'INTEGER', 'BIGINT', 'TEXT', 'DOUBLE', 'DATEONLY', 'BOOLEAN'];\n\nlet exp = {\n    defineModel: defineModel,\n    sync: () => {\n        // only allow create ddl in non-production environment:\n        if (process.env.NODE_ENV !== 'production') {\n            return sequelize.sync({force: true});\n        } else {\n            throw new Error('Cannot sync() when NODE_ENV is set to \\'production\\'.');\n        }\n    }\n};\n\nfor (let type of TYPES) {\n    exp[type] = Sequelize[type];\n}\n\nexp.ID = ID_TYPE;\nexp.generateId = generateId;\n\nexport default exp;\n","export default (pathPrefix) => {\n\n    pathPrefix = pathPrefix || '/api/';\n    return async (ctx, next) => {\n\n        if (ctx.request.path.startsWith(pathPrefix)) {\n            console.log(`Process API ${ctx.request.method} ${ctx.request.url}...`);\n\n            // 以api结尾的请求,给ctx添加上rest方法\n            ctx.rest = (data) => {\n                ctx.response.type = 'application/json';\n                ctx.response.body = data;\n                console.log(JSON.stringify(data));\n            }\n\n            try {\n                await next();\n            } catch (e) {\n                console.log('Process API error...');\n                ctx.response.status = 400;\n                ctx.response.type = 'application/json';\n                ctx.response.body = {code: e.code || 'internal:unknown_error', message: e.message || ''};\n            }\n        } else {\n            await next();\n        }\n    };\n}\n","import db from '../db-specs';\n\nexport default db.defineModel('users', {\n    email: {\n        type: db.STRING(100),\n        unique: true\n    },\n    passwd: db.STRING(100),\n    name: db.STRING(100),\n    gender: db.BOOLEAN\n});\n","var map = {\n\t\"./User.js\": 71\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 72;","export default {\n    dialect: 'mysql',\n    database: 'db_im', // 使用哪个数据库\n    username: 'im', // 用户名\n    password: 'im', // 口令\n    host: '116.196.91.32', // 主机名\n    port: 3306 // 端口号，MySQL默认3306\n};","export default {\n    dialect: 'mysql',\n    database: 'db_im', // 使用哪个数据库\n    username: 'im', // 用户名\n    password: 'im', // 口令\n    host: '116.196.91.32', // 主机名\n    port: 3306 // 端口号，MySQL默认3306\n};","import fs from 'fs';\n\nlet config = null;\n\nif (process.env.NODE_ENV === 'test') {\n    const testConfig = require('./config-test.js');\n\n    console.log(`Load ${testConfig}...`);\n    config = testConfig;\n\n} else {\n    const defaultConfig = require('./config-default.js');\n    const overrideConfig = require('./config-override.js');\n\n    console.log(`Load ${defaultConfig}...`);\n    config = defaultConfig;\n    try {\n        if (fs.statSync(overrideConfig).isFile()) {\n            console.log(`Load ${overrideConfig}...`);\n            config = Object.assign(config, overrideConfig);\n        }\n    } catch (err) {\n        console.log(`Cannot load ${overrideConfig}.`);\n    }\n}\n\nexport default config;\n","module.exports = require(\"node-uuid\");","module.exports = require(\"sequelize\");","// scan all models defined in models:\nimport fs from 'fs';\nimport db from './db-specs';\n\nconst exportModels = {};\n\nif (process.env.NODE_ENV === 'production') {\n    let context = require.context('./models', true, /\\.js$/);\n    context.keys().forEach(model => {\n        console.log(model);\n        let name = model.substring(2, model.length - 3);\n        exportModels[name] = context(model);\n    });\n} else {\n    let files = fs.readdirSync(__dirname + '/models');\n    let js_files = files.filter(f => f.endsWith('.js'), files);\n    for (let f of js_files) {\n        console.log(`import model from file ${f}...`);\n        let name = f.substring(0, f.length - 3);\n        exportModels[name] = require(__dirname + '/models/' + f);\n    }\n}\n\nexportModels.sync = () => {\n    return db.sync();\n};\n\nexport default exportModels;\n","export default class ApiError {\n\n    constructor(code, message) {\n        this.code = code || 'internal:unknown_error';\n        this.message = message || '';\n    }\n\n}","import ApiError from '../error';\nimport model from '../database/db-models';\nlet User = model.User;\n\n\nexport default {\n\n    'GET /api/users': async (ctx, next) => {\n        let users = await User.findAll();\n        if (users) {\n            ctx.rest({users: users});\n        } else {\n            throw new ApiError('users:not_found', 'user not found by id.');\n        }\n    }\n\n};\n","var map = {\n\t\"./user.js\": 80\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 81;","module.exports = require(\"koa-router\");","import Router from 'koa-router';\nimport fs from 'fs';\n\n// add url-route in /controllers:\n\nfunction addMapping(router, mapping) {\n    for (let url in mapping) {\n        if (url.startsWith('GET ')) {\n            var path = url.substring(4);\n            router.get(path, mapping[url]);\n            console.log(`register URL mapping: GET ${path}`);\n\n        } else if (url.startsWith('POST ')) {\n            var path = url.substring(5);\n            router.post(path, mapping[url]);\n            console.log(`register URL mapping: POST ${path}`);\n\n        } else if (url.startsWith('PUT ')) {\n            var path = url.substring(4);\n            router.put(path, mapping[url]);\n            console.log(`register URL mapping: PUT ${path}`);\n\n        } else if (url.startsWith('DELETE ')) {\n            var path = url.substring(7);\n            router.del(path, mapping[url]);\n            console.log(`register URL mapping: DELETE ${path}`);\n\n        } else {\n            console.log(`invalid URL: ${url}`);\n        }\n    }\n}\n\n\nfunction addControllers(router) {\n\n    if (process.env.NODE_ENV === 'production') {\n        let context = require.context('../apis', true, /\\.js$/);\n        context.keys().forEach(api => {\n            let mapping = context(api);\n            addMapping(router, mapping);\n        });\n\n    } else {\n        let dir = 'apis';\n        let apis_dir, current_dir = '/middlewares';\n        if (__dirname.endsWith(current_dir)) {\n            let endNum = __dirname.length - current_dir.length;\n            apis_dir = __dirname.substring(0, endNum)\n        }\n\n        fs.readdirSync(apis_dir + '/' + dir).filter((f) => {\n            return f.endsWith('.js');\n        }).forEach((f) => {\n            console.log(`process controller: ${f}...`);\n            let mapping = require(apis_dir + '/' + dir + '/' + f);\n            addMapping(router, mapping);\n        });\n    }\n}\n\nexport default () => {\n    let router = new Router();\n    addControllers(router);\n    return router.routes();\n};","module.exports = require(\"socket.io\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa\");","import Koa from 'koa';\nimport bodyParser from 'koa-bodyparser';\n\nimport SioServer from 'socket.io';\nimport {createServer} from 'http';\n\nimport bindApis from './middlewares/apis';\nimport bindRest from './middlewares/rest';\n\nconst koaApp = new Koa();\n\n// 打印URL\nkoaApp.use(async (ctx, next) => {\n    console.log(`${ctx.request.method} ${ctx.request.url}`);\n    await next(); // 调用下一个middleware\n});\n\n// 打印Request和Response之间的时长\nkoaApp.use(async (ctx, next) => {\n    const start = new Date().getTime(); // 当前时间\n    await next(); // 调用下一个middleware\n    const ms = new Date().getTime() - start; // 耗费时间\n    console.log(`Time: ${ms}ms`); // 打印耗费时间\n});\n\nkoaApp.use(bodyParser());\n\n// bind .rest() for ctx:\nkoaApp.use(bindRest());\n\n// add apis scanner:\nkoaApp.use(bindApis());\n\nconst webServer = createServer(koaApp.callback());\n\nconst io = new SioServer(webServer);\nio.on('connection', function (socket) {\n    socket.emit('news', {hello: 'world'});\n    socket.on('event', function (data) {\n        console.log(data);\n    });\n});\n\nexport default webServer;","import 'babel-polyfill';\nimport webServer from \"./app\";\n\nwebServer.listen(3001);\nconsole.log('im server started at port 3001...');"],"sourceRoot":""}