{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"fs\"","webpack:///external \"babel-polyfill\"","webpack:///./src/database/models/User.js","webpack:///./src/database/db-specs.js","webpack:///./src/middlewares/rest.js","webpack:///./src/database/models sync ^\\.\\/.*$","webpack:///./src/database/config/config-override.js","webpack:///./src/database/config/config-default.js","webpack:///./src/database/config/config.js","webpack:///external \"node-uuid\"","webpack:///external \"sequelize\"","webpack:///./src/database/db-models.js","webpack:///./src/error/index.js","webpack:///./src/apis/user.js","webpack:///./src/apis sync \\.js$","webpack:///external \"koa-router\"","webpack:///./src/middlewares/apis.js","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa\"","webpack:///./src/app.js","webpack:///./src/start.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","prototype","hasOwnProperty","p","s","e","t","require","db","defineModel","email","type","STRING","unique","passwd","gender","BOOLEAN","Sequelize","uuid","config","generateId","v4","console","log","sequelize","database","username","password","host","dialect","pool","max","min","idle","ID_TYPE","exp","attributes","attrs","key","_typeof","allowNull","id","primaryKey","createdAt","BIGINT","updatedAt","version","define","tableName","timestamps","hooks","beforeValidate","obj","now","Date","isNewRecord","sync","Error","f","_step","_iterator","Symbol","iterator","_iteratorNormalCompletion","next","done","ID","pathPrefix","regeneratorRuntime","mark","_callee","ctx","wrap","_context","prev","request","path","startsWith","method","url","rest","data","response","body","JSON","stringify","t0","catch","status","code","message","stop","_ref","_x","_x2","apply","this","arguments","map","./User","./User.js","webpackContext","req","webpackContextResolve","keys","resolve","port","fs","defaultConfig","overrideConfig","statSync","isFile","assign","err","files","readdirSync","__dirname","js_files","filter","endsWith","substring","length","ApiError","User","GET /api/users","bodys","findAll","sent","users","undefined","./user.js","mapping","router","Router","context","forEach","api","post","put","del","addControllers","routes","_http","u","a","Promise","then","_ref2","koaApp","Koa","use","_asyncToGenerator","_callee2","start","ms","_context2","getTime","_x3","_x4","_koaBodyparser2","_rest2","_apis2","webServer","createServer","callback","SioServer","on","socket","emit","hello","listen"],"mappings":"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","file":"sio_server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 26);\n","module.exports = require(\"fs\");","module.exports = require(\"babel-polyfill\");","const db = require('../db-specs');\n\nmodule.exports = db.defineModel('users', {\n    email: {\n        type: db.STRING(100),\n        unique: true\n    },\n    passwd: db.STRING(100),\n    name: db.STRING(100),\n    gender: db.BOOLEAN\n});\n","// import Sequelize from 'sequelize';\n// import uuid from 'node-uuid';\n// import config from './config/config';\n\nconst Sequelize = require('sequelize');\nconst uuid = require('node-uuid');\nconst config = require('./config/config');\n\nconsole.log('init sequelize...');\n\nfunction generateId() {\n    return uuid.v4();\n}\n\nlet sequelize = new Sequelize(\n    config.database,\n    config.username,\n    config.password,\n    {\n        host: config.host,\n        dialect: config.dialect,\n        pool: {\n            max: 5,\n            min: 0,\n            idle: 10000\n        }\n    }\n);\n\nconst ID_TYPE = Sequelize.STRING(50);\n\nfunction defineModel(name, attributes) {\n    let attrs = {};\n    for (let key in attributes) {\n        let value = attributes[key];\n        if (typeof value === 'object' && value['type']) {\n            value.allowNull = value.allowNull || false;\n            attrs[key] = value;\n        } else {\n            attrs[key] = {\n                type: value,\n                allowNull: false\n            };\n        }\n    }\n    attrs.id = {\n        type: ID_TYPE,\n        primaryKey: true\n    };\n    attrs.createdAt = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    attrs.updatedAt = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    attrs.version = {\n        type: Sequelize.BIGINT,\n        allowNull: false\n    };\n    // console.log('model defined for table: ' + name + '\\n' + JSON.stringify(attrs, function (k, v) {\n    //     if (k === 'type') {\n    //         for (let key in Sequelize) {\n    //             if (key === 'ABSTRACT' || key === 'NUMBER') {\n    //                 continue;\n    //             }\n    //             let dbType = Sequelize[key];\n    //             if (typeof dbType === 'function') {\n    //                 if (v instanceof dbType) {\n    //                     if (v._length) {\n    //                         return `${dbType.key}(${v._length})`;\n    //                     }\n    //                     return dbType.key;\n    //                 }\n    //                 if (v === dbType) {\n    //                     return dbType.key;\n    //                 }\n    //             }\n    //         }\n    //     }\n    //     return v;\n    // }, '  '));\n    return sequelize.define(name, attrs, {\n        tableName: name,\n        timestamps: false,\n        hooks: {\n            beforeValidate: function (obj) {\n                let now = Date.now();\n                if (obj.isNewRecord) {\n                    console.log('will create entity...' + obj);\n                    if (!obj.id) {\n                        obj.id = generateId();\n                    }\n                    obj.createdAt = now;\n                    obj.updatedAt = now;\n                    obj.version = 0;\n                } else {\n                    console.log('will update entity...');\n                    obj.updatedAt = now;\n                    obj.version++;\n                }\n            }\n        }\n    });\n}\n\nconst TYPES = ['STRING', 'INTEGER', 'BIGINT', 'TEXT', 'DOUBLE', 'DATEONLY', 'BOOLEAN'];\n\nlet exp = {\n    defineModel: defineModel,\n    sync: () => {\n        // only allow create ddl in non-production environment:\n        if (process.env.NODE_ENV !== 'production') {\n            return sequelize.sync({force: true});\n        } else {\n            throw new Error('Cannot sync() when NODE_ENV is set to \\'production\\'.');\n        }\n    }\n};\n\nfor (let type of TYPES) {\n    exp[type] = Sequelize[type];\n}\n\nexp.ID = ID_TYPE;\nexp.generateId = generateId;\n\nmodule.exports = exp;\n","export default (pathPrefix) => {\n\n    pathPrefix = pathPrefix || '/api/';\n    return async (ctx, next) => {\n\n        if (ctx.request.path.startsWith(pathPrefix)) {\n            console.log(`Process API ${ctx.request.method} ${ctx.request.url}...`);\n\n            // 以api结尾的请求,给ctx添加上rest方法\n            ctx.rest = (data) => {\n                ctx.response.type = 'application/json';\n                ctx.response.body = data;\n                console.log(JSON.stringify(data));\n            }\n\n            try {\n                await next();\n            } catch (e) {\n                console.log('Process API error...');\n                ctx.response.status = 400;\n                ctx.response.type = 'application/json';\n                ctx.response.body = {code: e.code || 'internal:unknown_error', message: e.message || ''};\n            }\n        } else {\n            await next();\n        }\n    };\n}\n","var map = {\n\t\"./User\": 2,\n\t\"./User.js\": 2\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 8;","var config = {\n    dialect: 'mysql',\n    database: 'db_im', // 使用哪个数据库\n    username: 'im', // 用户名\n    password: 'im', // 口令\n    host: '116.196.91.32', // 主机名\n    port: 3306 // 端口号，MySQL默认3306\n};\n\nmodule.exports = config;","var config = {\n    dialect: 'mysql',\n    database: 'db_im', // 使用哪个数据库\n    username: 'im', // 用户名\n    password: 'im', // 口令\n    host: '116.196.91.32', // 主机名\n    port: 3306 // 端口号，MySQL默认3306\n};\n\nmodule.exports = config;","const fs = require('fs');\n\nlet config = null;\n\nif (process.env.NODE_ENV === 'test') {\n    const testConfig = require('./config-test.js');\n\n    console.log(`Load ${testConfig}...`);\n    config = testConfig;\n\n} else {\n    const defaultConfig = require('./config-default.js');\n    const overrideConfig = require('./config-override.js');\n\n    console.log(`Load ${defaultConfig}...`);\n    config = defaultConfig;\n    try {\n        if (fs.statSync(overrideConfig).isFile()) {\n            console.log(`Load ${overrideConfig}...`);\n            config = Object.assign(config, overrideConfig);\n        }\n    } catch (err) {\n        console.log(`Cannot load ${overrideConfig}.`);\n    }\n}\n\nmodule.exports = config;\n","module.exports = require(\"node-uuid\");","module.exports = require(\"sequelize\");","// scan all models defined in models:\nconst fs = require('fs');\nconst db = require('./db-specs');\n\nlet files = fs.readdirSync(__dirname + '/models');\nlet js_files = files.filter(f => f.endsWith('.js'), files);\n\nmodule.exports = {};\n\n// TODO\n// let context = require.context('./models', true, /\\.js$/);\n// context.keys().forEach(model => {\n//     console.log(model);\n//     let name = model.substring(2, model.length - 3);\n//     module.exports[name] = context(model);\n// });\n\nfor (let f of js_files) {\n    console.log(`import model from file ${f}...`);\n    let name = f.substring(0, f.length - 3);\n    module.exports[name] = require(__dirname + '/models/' + f);\n}\n\nmodule.exports.sync = () => {\n    return db.sync();\n};\n","export default class ApiError {\n\n    constructor(code, message) {\n        this.code = code || 'internal:unknown_error';\n        this.message = message || '';\n    }\n\n}","import ApiError from '../error';\n\nconst model = require('../database/db-models');\n\nlet User = model.User;\n\n\nexport default {\n\n    'GET /api/users': async (ctx, next) => {\n        let users = await User.findAll();\n        if (users) {\n            ctx.rest({users: users});\n        } else {\n            throw new ApiError('users:not_found', 'user not found by id.');\n        }\n    }\n\n};\n","var map = {\n\t\"./user.js\": 16\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 17;","module.exports = require(\"koa-router\");","import Router from 'koa-router';\nimport fs from 'fs';\n\n// add url-route in /controllers:\n\nfunction addMapping(router, mapping) {\n    for (let url in mapping) {\n        if (url.startsWith('GET ')) {\n            var path = url.substring(4);\n            router.get(path, mapping[url]);\n            console.log(`register URL mapping: GET ${path}`);\n\n        } else if (url.startsWith('POST ')) {\n            var path = url.substring(5);\n            router.post(path, mapping[url]);\n            console.log(`register URL mapping: POST ${path}`);\n\n        } else if (url.startsWith('PUT ')) {\n            var path = url.substring(4);\n            router.put(path, mapping[url]);\n            console.log(`register URL mapping: PUT ${path}`);\n\n        } else if (url.startsWith('DELETE ')) {\n            var path = url.substring(7);\n            router.del(path, mapping[url]);\n            console.log(`register URL mapping: DELETE ${path}`);\n\n        } else {\n            console.log(`invalid URL: ${url}`);\n        }\n    }\n}\n\n\nfunction addControllers(router) {\n\n    if (process.env.NODE_ENV === 'production') {\n        let context = require.context('../apis', true, /\\.js$/);\n        context.keys().forEach(api => {\n            let mapping = context(api);\n            addMapping(router, mapping);\n        });\n\n    } else {\n        let dir = 'apis';\n        let apis_dir, current_dir = '/middlewares';\n        if (__dirname.endsWith(current_dir)) {\n            let endNum = __dirname.length - current_dir.length;\n            apis_dir = __dirname.substring(0, endNum)\n        }\n\n        fs.readdirSync(apis_dir + '/' + dir).filter((f) => {\n            return f.endsWith('.js');\n        }).forEach((f) => {\n            console.log(`process controller: ${f}...`);\n            let mapping = require(apis_dir + '/' + dir + '/' + f);\n            addMapping(router, mapping);\n        });\n    }\n}\n\nexport default () => {\n    let router = new Router();\n    addControllers(router);\n    return router.routes();\n};","module.exports = require(\"http\");","module.exports = require(\"socket.io\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa\");","import Koa from 'koa';\nimport bodyParser from 'koa-bodyparser';\n\nimport SioServer from 'socket.io';\nimport {createServer} from 'http';\n\nimport bindApis from './middlewares/apis';\nimport bindRest from './middlewares/rest';\n\nconst koaApp = new Koa();\n\n// 打印URL\nkoaApp.use(async (ctx, next) => {\n    console.log(`${ctx.request.method} ${ctx.request.url}`);\n    await next(); // 调用下一个middleware\n});\n\n// 打印Request和Response之间的时长\nkoaApp.use(async (ctx, next) => {\n    const start = new Date().getTime(); // 当前时间\n    await next(); // 调用下一个middleware\n    const ms = new Date().getTime() - start; // 耗费时间\n    console.log(`Time: ${ms}ms`); // 打印耗费时间\n});\n\nkoaApp.use(bodyParser());\n\n// bind .rest() for ctx:\nkoaApp.use(bindRest());\n\n// add apis scanner:\nkoaApp.use(bindApis());\n\nconst webServer = createServer(koaApp.callback());\n\nconst io = new SioServer(webServer);\nio.on('connection', function (socket) {\n    socket.emit('news', {hello: 'world'});\n    socket.on('event', function (data) {\n        console.log(data);\n    });\n});\n\nmodule.exports = {koaApp, webServer};","import {webServer} from \"./app\";\n\nwebServer.listen(3001);\nconsole.log('im server started at port 3001...');"],"sourceRoot":""}